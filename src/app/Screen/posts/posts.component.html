<ion-content class="custom-scroll" id="pantallaPosts">
  <ion-grid class="ion-no-padding post-container movil">
    <div class="scroll-container" id="posts">
      <ion-list class="post-list">
        <ion-item class="post-list-item">
          <ion-select aria-label="Post Filter" [(ngModel)]="selectedFilter" (ionChange)="onFilterChange()">
            <ion-select-option value="recientes">Recientes</ion-select-option>
            <ion-select-option value="mas-gustados">Más Gustados</ion-select-option>
            <ion-select-option value="mas-hablados">Más Hablados</ion-select-option>
            <ion-select-option value="seguidores">Seguidores</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-list>
      <ion-row *ngFor="let post of posts; let i = index" class="post">
        <ion-col class="user-info" size="12" style="display: flex; justify-content: space-between; align-items: center;">
          <!-- Contenedor izquierdo: Avatar y Nombre de usuario -->
            <div style="display: flex; align-items: center;">
              <ion-button fill="clear" (click)="navigateToProfile(post.post?.id)" style="padding: 0;">
                <ion-avatar >
                  <img [src]="post.avatar" alt="Imagen de perfil"/>
                </ion-avatar>
              </ion-button>
                <span class="username">{{ post.nickname }}</span>
              <span class="post-date">
              {{ post.post?.createdAt | date:'dd/MM/yyyy HH:mm' }}
                </span>
            </div>
          <!-- Icono alineado a la derecha con evento de click -->
          <ion-icon name="ellipsis-horizontal" class="more-button" (click)="presentPopover(i, $event, post)"></ion-icon>

          <!-- Popover específico para cada post -->
          <ion-popover [isOpen]="openPopoverIndex === i" (didDismiss)="openPopoverIndex = -1">
            <ng-template>
              <div *ngIf="!isAdmin1" style="margin: auto; padding-top: 10px;">
                <ion-select [(ngModel)]="reportReason1" placeholder="Razón de reporte">
                  <ion-select-option value="spam">Spam</ion-select-option>
                  <ion-select-option value="abuso">Abuso</ion-select-option>
                  <ion-select-option value="contenido_inapropiado">Contenido inapropiado</ion-select-option>
                  <ion-select-option value="informacion_falsa">Información falsa</ion-select-option>
                  <ion-select-option value="otro">Otro</ion-select-option>
                </ion-select>

                <ion-input *ngIf="reportReason1 === 'otro'" placeholder="Razón de reporte" [(ngModel)]="reportReason"></ion-input>
                <ion-col class="post-actions" size="12" style="display: flex; justify-content: center;">
                  <ion-button color="danger" (click)="reportPost(post)">
                    <ion-icon name="trash" slot="start"></ion-icon>
                    <ion-label>Reportar</ion-label>
                  </ion-button>
                </ion-col>
              </div>
              <div *ngIf="isAdmin1" style="margin: auto">
                <ion-col class="post-actions" size="12" style="display: flex; justify-content: center;">
                  <ion-button color="danger" (click)="deletePost(post, 'SANCTIONED')">
                    <ion-icon name="trash" slot="start"></ion-icon>
                    <ion-label>Eliminar y advertir</ion-label>
                  </ion-button>
                </ion-col>
                <ion-col class="post-actions" size="12" style="display: flex; justify-content: center;">
                  <ion-button color="success" (click)="deletePost(post, 'SOLVED')">
                    <ion-icon name="exit-outline" slot="start"></ion-icon>
                    <ion-label>Dejar pasar</ion-label>
                  </ion-button>
                </ion-col>
              </div>
            </ng-template>
          </ion-popover>
        </ion-col>

                <!-- Imagen Principal -->
                <ion-col *ngIf="post.image_post" size="12" class="post-image">
                    <ion-img [src]="post.image_post" class="responsive-image"></ion-img>
                </ion-col>


                <!-- Descripción -->
             <ion-col size="12" class="post-description" [innerHTML]="highlightHashtags(post.post?.content)">
             </ion-col>
             <!-- Acciones del PostDetails -->
                <ion-col size="12" class="post-actions">
                    <ion-button (click)="likePost(post)" fill="clear" class="action-button" id="like-button">
                        <ion-icon [name]="post.liked ? 'heart' : 'heart-outline'"></ion-icon>
                        <span>{{ post.numlikes }}</span>
                    </ion-button>
                    <ion-button fill="clear" class="action-button" (click)="openNewCommentModal(post.post?.id)" id="chat">
                        <ion-icon name="chatbubble"></ion-icon>
                        <span>{{ post.numcomments }}</span>
                    </ion-button>
                    <ion-button fill="clear" class="action-button save-button" (click)="savePost(post)" id="guardar">
                        <ion-icon [name]="post.saved ? 'bookmark' : 'bookmark-outline'"></ion-icon>
                    </ion-button>
                    <ion-button fill="clear" class="action-button" (click)="sharePost(post)" id="compartir">
                        <ion-icon name="share-social"></ion-icon>
                    </ion-button>

                </ion-col>

                <!-- Comentario Destacado -->
                <ion-col size="12" class="highlighted-comment" (click)="viewPostDetails(post)" id="comentarios">
                    <div class="comment-container">
                        <ion-avatar *ngIf="post.avatarcomment">
                            <img [src]="post.avatarcomment" fill/>
                        </ion-avatar>
                        <span class="comment">
      <b>{{ post.nicknamecomment }}</b> {{ post.firstcomment }}
    </span>
                    </div>
                </ion-col>
            </ion-row>
        </div>
    </ion-grid>
    <ion-fab vertical="bottom" horizontal="end" slot="fixed">
        <ion-fab-button  id="publicar" class="custom-fab-button" (click)="openAddPostModal()">
            <ion-icon name="add" class="custom-fab-icon"></ion-icon>
        </ion-fab-button>
    </ion-fab>
</ion-content>


